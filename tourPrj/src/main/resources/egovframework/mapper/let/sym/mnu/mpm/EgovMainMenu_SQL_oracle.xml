<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="menuManageDAO">

	
	<select id="selectMainMenuHead" parameterType="egovframework.let.sym.mnu.mpm.service.MenuManageVO" resultType="egovMap">
		 
            SELECT menuNo as "menuNo"
	  ,menuOrdr as "menuOrdr"
	  ,menuNm as "menuNm"
	  ,upperMenuId as "upperMenuId"
	  ,relateImagePath as "relateImagePath"
	  ,relateImageNm as "relateImageNm"
	  ,CASE WHEN chkurl = '/' THEN 
							(SELECT CC.URL
							   FROM (SELECT ROW_NUMBER() OVER(ORDER BY BB.MENU_ORDR) AS RN, BB.PROGRM_FILE_NM
									   FROM LETTNMENUINFO BB
									  WHERE BB.UPPER_MENU_NO = AA.DEPP_MENU_NO) BD
								   ,LETTNPROGRMLIST CC
						      WHERE 1=1 
						        AND BD.PROGRM_FILE_NM = CC.PROGRM_FILE_NM
						        AND RN = 1
							)
						ELSE
							CHKURL
						END AS "chkURL"
	  ,DEPP_MENU_NO
	 
  FROM (
			SELECT
						       B.MENU_NO AS menuNo
							 ,
						B.MENU_ORDR AS menuOrdr
									 ,
						B.MENU_NM AS menuNm
									 ,
						B.UPPER_MENU_NO AS upperMenuId
									 ,
						B.RELATE_IMAGE_PATH AS relateImagePath
									 ,
						B.RELATE_IMAGE_NM AS relateImageNm
									 ,
						CASE WHEN C.URL = '/' THEN 
							(SELECT CC.URL
							   FROM (SELECT ROW_NUMBER() OVER(ORDER BY BB.MENU_ORDR) AS RN, BB.PROGRM_FILE_NM, C.URL
									   FROM LETTNMENUINFO BB
									  WHERE BB.UPPER_MENU_NO = B.MENU_NO) BD
								   ,LETTNPROGRMLIST CC
						      WHERE 1=1 
						        AND BD.PROGRM_FILE_NM = CC.PROGRM_FILE_NM
						        AND RN = 1
							)
						ELSE
							C.URL
						END AS chkURL
						,
						CASE WHEN C.URL = '/' THEN 
							(SELECT MENU_NO
							   FROM (SELECT ROW_NUMBER() OVER(ORDER BY BB.MENU_ORDR) AS RN, BB.PROGRM_FILE_NM, BB.MENU_NO
									   FROM LETTNMENUINFO BB
									  WHERE BB.UPPER_MENU_NO = B.MENU_NO) BD
								   ,LETTNPROGRMLIST CC
						      WHERE 1=1 
						        AND BD.PROGRM_FILE_NM = CC.PROGRM_FILE_NM
						        AND RN = 1
							)
						ELSE
							NULL
						END AS DEPP_MENU_NO
					FROM
						LETTNMENUCREATDTLS A,
						LETTNMENUINFO B,
						LETTNPROGRMLIST C
					WHERE  B.Menu_NO &gt; 0 
						AND    B.UPPER_MENU_NO = 0  
						AND A.MENU_NO = B.MENU_NO
						AND B.PROGRM_FILE_NM = C.PROGRM_FILE_NM
						AND    A.AUTHOR_CODE = (SELECT AUTHOR_CODE from LETTNEMPLYRSCRTYESTBS
				                                WHERE  SCRTY_DTRMN_TRGET_ID = #{tmp_UniqId})
						ORDER BY B.MENU_ORDR
			
			) AA
		 
	</select>

	<select id="selectMainMenuLeft" parameterType="egovframework.let.sym.mnu.mpm.service.MenuManageVO" resultType="egovMap">
		 
			SELECT
			       B.MENU_NO AS "menuNo"
				 ,
			B.MENU_ORDR AS "menuOrdr"
						 ,
			B.MENU_NM AS "menuNm"
						 ,
			B.UPPER_MENU_NO AS "upperMenuId"
						 ,
			B.RELATE_IMAGE_PATH AS "relateImagePath"
						 ,
			B.RELATE_IMAGE_NM AS "relateImageNm"
						 ,
			CASE WHEN C.URL = '/' THEN 
				(SELECT CC.URL
				   FROM (SELECT ROW_NUMBER() OVER(ORDER BY BB.MENU_ORDR) AS RN, BB.PROGRM_FILE_NM, C.URL
						   FROM LETTNMENUINFO BB
						  WHERE BB.UPPER_MENU_NO = B.MENU_NO) BD
					   ,LETTNPROGRMLIST CC
			      WHERE 1=1 
			        AND BD.PROGRM_FILE_NM = CC.PROGRM_FILE_NM
			        AND RN = 1
				)
			ELSE
				C.URL
			END AS "chkURL"
		FROM
			LETTNMENUCREATDTLS A,
			LETTNMENUINFO B,
			LETTNPROGRMLIST C
		WHERE
			A.MENU_NO = B.MENU_NO
			AND B.PROGRM_FILE_NM = C.PROGRM_FILE_NM
			AND    A.AUTHOR_CODE = (SELECT AUTHOR_CODE from LETTNEMPLYRSCRTYESTBS
	                                WHERE  SCRTY_DTRMN_TRGET_ID = #{tmp_UniqId})
			ORDER BY B.MENU_ORDR
		 
	</select>

	<select id="selectLastMenuURL" parameterType="egovframework.let.sym.mnu.mpm.service.MenuManageVO" resultType="String">
		 
			SELECT URL 
			FROM   LETTNPROGRMLIST
			WHERE  PROGRM_FILE_NM =
			       (SELECT PROGRM_FILE_NM FROM LETTNMENUINFO
				    WHERE MENU_NO = #{menuNo})
		 
	</select>

	<select id="selectLastMenuNo" parameterType="egovframework.let.sym.mnu.mpm.service.MenuManageVO" resultType="int">
		 
			select MIN(MENU_NO) 
			from   LETTNMENUINFO
			where  UPPER_MENU_NO = #{menuNo}
			and    MENU_ORDR =
			      (select MIN(MENU_ORDR) 
			       from LETTNMENUCREATDTLS A, LETTNMENUINFO B
			       where A.MENU_NO = B.MENU_NO
			       AND   A.AUTHOR_CODE = (SELECT AUTHOR_CODE from LETTNEMPLYRSCRTYESTBS
	                                      WHERE  SCRTY_DTRMN_TRGET_ID = #{tempValue})
			       AND   B.UPPER_MENU_NO = #{menuNo})
		 
	</select>

	<select id="selectLastMenuNoCnt" parameterType="egovframework.let.sym.mnu.mpm.service.MenuManageVO" resultType="int">
		 
			select count(MENU_NO) 
			from   LETTNMENUINFO
			where  UPPER_MENU_NO = #{menuNo}
			and    MENU_ORDR =
			      (select MIN(MENU_ORDR) 
			       from LETTNMENUCREATDTLS A, LETTNMENUINFO B
			       where A.MENU_NO = B.MENU_NO
			       AND   A.AUTHOR_CODE = (SELECT AUTHOR_CODE from LETTNEMPLYRSCRTYESTBS
	                                      WHERE  SCRTY_DTRMN_TRGET_ID = #{tempValue})
			       AND   B.UPPER_MENU_NO = #{menuNo})
		 
	</select>
</mapper>